@model ExamApp.Core.Models.Question
@{
    ViewData["Title"] = "Soruyu Düzenle";

    // Null kontrolü
    if (Model == null)
    {
        // Model null ise hata sayfasına yönlendir veya boş model oluştur
        <div class="alert alert-danger">Soru bulunamadı!</div>
        return;
    }
}

<div class="container">
    <h2>Soruyu Düzenle</h2>

    <form asp-action="EditQuestion" method="post">
        <input type="hidden" asp-for="Id" />

        <div class="mb-3">
            <label asp-for="Text" class="form-label">Soru Metni</label>
            <textarea asp-for="Text" class="form-control" rows="3" required>@Model.Text</textarea>
            <span asp-validation-for="Text" class="text-danger"></span>
        </div>

        <div class="row mb-3">

            <div class="col-md-6">
                <label asp-for="OptionA" class="form-label">A Şıkkı</label>
                <input asp-for="OptionA" class="form-control" value="@Model.OptionA" required>
                <span asp-validation-for="OptionA" class="text-danger"></span>
            </div>
            <div class="col-md-6">
                <label asp-for="OptionB" class="form-label">B Şıkkı</label>
                <input asp-for="OptionB" class="form-control" value="@Model.OptionB" required>
                <span asp-validation-for="OptionB" class="text-danger"></span>
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <label asp-for="OptionC" class="form-label">C Şıkkı</label>
                <input asp-for="OptionC" class="form-control" value="@Model.OptionC" required>
                <span asp-validation-for="OptionC" class="text-danger"></span>
            </div>
            <div class="col-md-6">
                <label asp-for="OptionD" class="form-label">D Şıkkı</label>
                <input asp-for="OptionD" class="form-control" value="@Model.OptionD" required>
                <span asp-validation-for="OptionD" class="text-danger"></span>
            </div>
        </div>

        <!-- Doğru Cevap Dropdown -->
        <div class="mb-3">
            <label asp-for="CorrectAnswer" class="form-label">Doğru Cevap</label>
            <select asp-for="CorrectAnswer" class="form-control" required>
                <option value="">Doğru Cevabı Seçin</option>
                <option value="@Model.OptionA" selected="@(Model.CorrectAnswer == Model.OptionA)">A) @Model.OptionA</option>
                <option value="@Model.OptionB" selected="@(Model.CorrectAnswer == Model.OptionB)">B) @Model.OptionB</option>
                <option value="@Model.OptionC" selected="@(Model.CorrectAnswer == Model.OptionC)">C) @Model.OptionC</option>
                <option value="@Model.OptionD" selected="@(Model.CorrectAnswer == Model.OptionD)">D) @Model.OptionD</option>
            </select>
            <small class="form-text text-muted">Doğru cevabın metnini seçin (A/B/C/D değil)</small>
            <span asp-validation-for="CorrectAnswer" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="Points" class="form-label">Puan</label>
            <input asp-for="Points" type="number" class="form-control" value="@Model.Points" required min="1" max="100">
            <span asp-validation-for="Points" class="text-danger"></span>
        </div>

        <button type="submit" class="btn btn-warning">Güncelle</button>
        <a href="@Url.Action("Dashboard")" class="btn btn-secondary">İptal</a>
    </form>
</div>

@section Scripts {
    <script>
        // Doğru cevap dropdown'ını dinamik olarak güncelle
        document.addEventListener('DOMContentLoaded', function() {
            const optionAInput = document.querySelector('#OptionA');
            const optionBInput = document.querySelector('#OptionB');
            const optionCInput = document.querySelector('#OptionC');
            const optionDInput = document.querySelector('#OptionD');
            const correctAnswerSelect = document.querySelector('#CorrectAnswer');

            function updateCorrectAnswerOptions() {
                const optionA = optionAInput.value;
                const optionB = optionBInput.value;
                const optionC = optionCInput.value;
                const optionD = optionDInput.value;

                // Mevcut seçili değeri sakla
                const currentValue = correctAnswerSelect.value;

                // Option'ları güncelle
                correctAnswerSelect.innerHTML = `
                    <option value="">Doğru Cevabı Seçin</option>
                    <option value="${optionA}">A) ${optionA}</option>
                    <option value="${optionB}">B) ${optionB}</option>
                    <option value="${optionC}">C) ${optionC}</option>
                    <option value="${optionD}">D) ${optionD}</option>
                `;

                // Eğer önceki değer hala geçerliyse, onu seç
                if (currentValue && [optionA, optionB, optionC, optionD].includes(currentValue)) {
                    correctAnswerSelect.value = currentValue;
                }
            }

            // Input değişikliklerini dinle
            optionAInput.addEventListener('input', updateCorrectAnswerOptions);
            optionBInput.addEventListener('input', updateCorrectAnswerOptions);
            optionCInput.addEventListener('input', updateCorrectAnswerOptions);
            optionDInput.addEventListener('input', updateCorrectAnswerOptions);
        });
    </script>
}